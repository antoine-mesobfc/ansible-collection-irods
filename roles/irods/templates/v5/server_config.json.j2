{
    "schema_name": "server_config",
    "schema_version": "{{ irods_config_schema_version }}",
    "advanced_settings": {
        "checksum_read_buffer_size_in_bytes": 1048576,
        "default_number_of_transfer_threads": 4,
        "default_temporary_password_lifetime_in_seconds": 120,
        "delay_rule_executors": [
	    "{{ irods_catalog_provider_hosts[0] }}"{% for host in irods_catalog_provider_hosts[1:] %},
            "{{ host }}"
            {% endfor %}
        ],
        "delay_server_sleep_time_in_seconds" : 30,
        "dns_cache": {
            "shared_memory_size_in_bytes": 5000000,
            "eviction_age_in_seconds": 3600,
            "cache_clearer_sleep_time_in_seconds": 600
        },
        "hostname_cache": {
            "shared_memory_size_in_bytes": 2500000,
            "eviction_age_in_seconds": 3600,
            "cache_clearer_sleep_time_in_seconds": 600
        },
        "maximum_size_for_single_buffer_in_megabytes": 32,
        "maximum_size_of_delay_queue_in_bytes": 0,
        "maximum_temporary_password_lifetime_in_seconds": 1000,
        "migrate_delay_server_sleep_time_in_seconds": 5,
        "number_of_concurrent_delay_rule_executors": 4,
        "stacktrace_file_processor_sleep_time_in_seconds": 10,
        "transfer_buffer_size_for_parallel_transfer_in_megabytes": 4,
        "transfer_chunk_size_for_parallel_transfer_in_megabytes": 40
    },
    "controlled_user_connection_list": {
        "control_type": "denylist",
        "users": []
    },
    "catalog_provider_hosts": [
        "{{ irods_catalog_provider_hosts[0] }}"{% for host in irods_catalog_provider_hosts[1:] %},
        "{{ host }}"
        {% endfor %}
    ],
    "catalog_service_role": "{{ "provider" if ansible_role_irods_is_catalog else "consumer" }}",
    {% if irods_cs_ssl %}
    "client_server_policy": "CS_NEG_REQUIRE",
    "tls_server": {
        "certificate_chain_file": "{{ irods_ssl_certificate_chain_file }}",
        "certificate_key_file": "{{ irods_ssl_certificate_key_file }}",
        "dh_params_file": "{{ irods_ssl_dh_params_file }}"
    },
    "tls_client": {
        "ca_certificate_file": "{{ irods_ssl_ca_certificate_file }}",
        "ca_certificate_path": "/etc/ssl/certs",
        "verify_server": "{{ irods_ssl_verify_server }}"
    },

    {% else %}
    "client_server_policy": "CS_NEG_REFUSE",
    {% endif %}
    "connection_pool_refresh_time_in_seconds": 300,
    "default_dir_mode": "0750",
    "default_file_mode": "0600",
    "default_hash_scheme": "SHA256",
    "default_resource_name": "{{ irods_default_resource_name }}",
    "encryption": {
        "algorithm": "AES-256-CBC",
        "key_size": 32,
        "num_hash_rounds": 16,
        "salt_size": 8
    },
    "environment_variables": {
        {% if ansible_role_irods_is_catalog %}
        "IRODS_DATABASE_USER_PASSWORD_SALT": "{{ irods_database_user_password_salt }}"
        {% endif %}
    },
    "federation": [],
    "graceful_shutdown_timeout_in_seconds": 30,
    "host": "{{ inventory_hostname }}",
    "host_access_control": {
        "access_entries": []
    },
    "host_resolution": {% include irods_config_schema_version + "/hosts_config.json.j2" %},
    "log_level": {
        "agent": "info",
        "agent_factory": "info",
        "api": "info",
        "authentication": "info",
        "database": "info",
        "delay_server": "info",
        "genquery1": "info",
        "genquery2": "info",
        "legacy": "info",
        "microservice": "info",
        "network": "info",
        "resource": "info",
        "rule_engine": "info",
        "server": "info",
        "sql": "info"
    },
    "match_hash_policy": "compatible",
    "negotiation_key": "{{ irods_negotiation_key }}",
    "plugin_configuration": {
        "authentication" : {},
        {% if ansible_role_irods_is_catalog %}
        "database": {
            "technology": "postgres", 
            "host": "{{ irods_db_host }}",
            "name": "{{ irods_db_name }}",
            "odbc_driver": "{{ irods_db_odbc_driver }}",
            "password": "{{ irods_db_password }}",
            "port": {{ irods_db_port }},
            "username": "{{ irods_db_username }}"
        },
        {% endif %}
        "network": {},
        "resource" : {},
        "rule_engines": [
            {
                "instance_name": "irods_rule_engine_plugin-irods_rule_language-instance",
                "plugin_name": "irods_rule_engine_plugin-irods_rule_language",
                "plugin_specific_configuration": {
                        "re_data_variable_mapping_set": [
                            "core"
                        ],
                        "re_function_name_mapping_set": [
                            "core"
                        ],
                        "re_rulebase_set": [
                            "core"
                        ],
                        "regexes_for_supported_peps": [
                            "ac[^ ]*",
                            "msi[^ ]*",
                            "[^ ]*pep_[^ ]*_(pre|post|except|finally)"
                        ]
                },
                "shared_memory_instance" : "irods_rule_language_rule_engine"
            },
            {
                "instance_name": "irods_rule_engine_plugin-cpp_default_policy-instance",
                "plugin_name": "irods_rule_engine_plugin-cpp_default_policy",
                "plugin_specific_configuration": {
                }
            }
        ]
    },
    "rule_engine_namespaces": [
        ""
    ],
    "server_port_range_start": {{ irods_server_port_range_start }},
    "server_port_range_end": {{ irods_server_port_range_end }},
    "zone_auth_scheme": "native",
    "zone_key": "{{irods_zone_key }}",
    "zone_name": "{{irods_zone_name }}",
    "zone_port": {{irods_zone_port }},
    "zone_user": "{{irods_zone_user }}"
}
